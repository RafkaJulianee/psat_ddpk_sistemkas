<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Pengeluaran Kas</title>
  <link rel="shortcut icon" href="rpl.png" type="image/x-icon" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #4a6cf7;
      --primary-light: #6a8aff;
      --primary-dark: #3a5ae0;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --light: #f8f9fa;
      --dark: #1e293b;
      --card-bg: #ffffff;
      --input-bg: #f8fafc;
      --border-color: #e2e8f0;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
      --dashboard-bg: #f5f7fb;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: var(--dashboard-bg);
      min-height: 100vh;
      padding: 30px 20px;
      color: var(--dark);
    }

    .container {
      max-width: 800px;
      background: var(--card-bg);
      padding: 30px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      margin: auto;
      border: 1px solid var(--border-color);
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 25px;
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
      transition: var(--transition);
    }

    .back-btn:hover {
      color: var(--primary-dark);
      text-decoration: none;
    }

    h2, h3 {
      font-weight: 700;
      margin-bottom: 25px;
      color: var(--dark);
      text-align: center;
    }

    .form-group {
      margin-bottom: 20px;
      position: relative;
    }

    label {
      display: block;
      margin-bottom: 10px;
      font-weight: 600;
      color: var(--dark);
      font-size: 0.95rem;
    }

    .form-group i {
      position: absolute;
      left: 15px;
      top: 42px;
      color: var(--primary);
      font-size: 18px;
    }

    input, textarea {
      width: 100%;
      padding: 14px 14px 14px 45px;
      border-radius: 12px;
      border: 2px solid var(--border-color);
      background: var(--input-bg);
      font-size: 16px;
      transition: var(--transition);
      outline: none;
      color: var(--dark);
    }

    textarea {
      min-height: 100px;
      resize: vertical;
    }

    input:focus, textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.2);
    }

    .btn-submit {
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      color: white;
      border: none;
      padding: 14px 20px;
      font-weight: 600;
      font-size: 16px;
      border-radius: 12px;
      cursor: pointer;
      transition: var(--transition);
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      box-shadow: 0 4px 15px rgba(74, 108, 247, 0.25);
      margin-top: 10px;
    }

    .btn-submit:hover {
      background: linear-gradient(90deg, var(--primary-dark), var(--primary));
      transform: translateY(-3px);
      box-shadow: 0 6px 20px rgba(74, 108, 247, 0.35);
    }

    .btn-submit:active {
      transform: translateY(0);
    }

    .expense-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 10px;
      margin-top: 30px;
    }

    .expense-table th {
      text-align: left;
      font-weight: 700;
      padding: 12px 15px;
      border-bottom: 2px solid var(--primary);
      color: var(--dark);
    }

    .expense-table td {
      padding: 15px;
      vertical-align: middle;
      background: var(--input-bg);
      border-radius: 8px;
      transition: var(--transition);
    }

    .expense-table tr:hover td {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
    }

    .text-right {
      text-align: right;
    }

    .btn-delete {
      background-color: var(--danger);
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .btn-delete:hover {
      background-color: #b02a37;
    }

    .total-row {
      font-weight: 700;
      background: rgba(74, 108, 247, 0.1) !important;
    }

    .history-section {
      margin-top: 40px;
      background: var(--input-bg);
      border-radius: 16px;
      padding: 25px;
      box-shadow: var(--shadow);
    }

    .history-list {
      max-height: 300px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .history-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid var(--border-color);
      align-items: center;
    }

    .history-item:last-child {
      border-bottom: none;
    }

    .history-item div:first-child {
      flex: 1;
    }

    .history-item div:last-child {
      min-width: 100px;
      text-align: right;
      font-weight: 600;
      color: var(--primary);
    }

    .history-date {
      font-size: 0.85rem;
      color: var(--secondary);
      margin-top: 3px;
    }

    .empty-state {
      text-align: center;
      padding: 20px;
      color: var(--secondary);
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--input-bg);
      border-radius: 10px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--primary);
      border-radius: 10px;
    }

    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      .expense-table {
        display: block;
        overflow-x: auto;
      }
      
      .history-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }
      
      .history-item div:last-child {
        text-align: left;
        width: 100%;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <a href="dashboard.html" class="back-btn">
      <i class="bi bi-arrow-left"></i> Kembali ke Dashboard
    </a>
    
    <h2>Catat Pengeluaran Kas Kelas</h2>

    <form id="formPengeluaran">
      <div class="form-group">
        <label for="keterangan">Keterangan</label>
        <i class="bi bi-card-text"></i>
        <textarea id="keterangan" placeholder="Misal: Beli alat tulis" required></textarea>
      </div>

      <div class="form-group">
        <label for="jumlah">Jumlah (Rp)</label>
        <i class="bi bi-cash-stack"></i>
        <input type="number" id="jumlah" placeholder="Masukkan jumlah pengeluaran" min="1" required />
      </div>

      <div class="form-group">
        <label for="tanggal">Tanggal</label>
        <i class="bi bi-calendar"></i>
        <input type="date" id="tanggal" required />
      </div>

      <button type="submit" class="btn-submit">
        <i class="bi bi-plus-circle"></i> Tambah Pengeluaran
      </button>
    </form>

    <table class="expense-table">
      <thead>
        <tr>
          <th>Keterangan</th>
          <th>Tanggal</th>
          <th class="text-right">Jumlah</th>
          <th>Aksi</th>
        </tr>
      </thead>
      <tbody id="listPengeluaran">
        <!-- Data pengeluaran akan muncul di sini -->
      </tbody>
      <tfoot>
        <tr>
          <td colspan="2" class="total-row">Total Pengeluaran:</td>
          <td class="text-right total-row" id="totalPengeluaran">Rp 0</td>
          <td class="total-row"></td>
        </tr>
      </tfoot>
    </table>

    <div class="history-section">
      <h3>Riwayat Pengeluaran Terbaru</h3>
      <div class="history-list" id="historyList">
        <!-- Riwayat pengeluaran akan muncul di sini -->
      </div>
    </div>
  </div>

  <script>
    // Ambil elemen-elemen HTML yang dibutuhkan
    const form = document.getElementById("formPengeluaran");
    const listPengeluaran = document.getElementById("listPengeluaran");
    const totalPengeluaranElem = document.getElementById("totalPengeluaran");
    const historyList = document.getElementById("historyList");

    // Ambil data pengeluaran dari localStorage jika ada, atau gunakan array kosong
    let pengeluaranData = JSON.parse(localStorage.getItem("pengeluaranData")) || [];

    // Fungsi untuk merender data pengeluaran ke tabel
    function renderPengeluaran() {
      listPengeluaran.innerHTML = ""; // Kosongkan isi tabel terlebih dahulu
      let total = 0;

      // Loop semua data pengeluaran
      pengeluaranData.forEach((item, idx) => {
        total += item.jumlah; // Tambahkan ke total

        // Format tanggal
        const formattedDate = new Date(item.tanggal).toLocaleDateString('id-ID', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
        });

        // Buat baris tabel untuk setiap pengeluaran
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.keterangan}</td>
          <td>${formattedDate}</td>
          <td class="text-right">Rp ${item.jumlah.toLocaleString('id-ID')}</td>
          <td>
            <button class="btn-delete" data-idx="${idx}">
              <i class="bi bi-trash"></i> Hapus
            </button>
          </td>
        `;
        listPengeluaran.appendChild(tr); // Tambahkan ke tabel
      });

      // Tampilkan total pengeluaran
      totalPengeluaranElem.textContent = `Rp ${total.toLocaleString('id-ID')}`;

      // Tampilkan bagian riwayat
      renderHistory();
    }

    // Fungsi untuk menampilkan 5 riwayat pengeluaran terbaru
    function renderHistory() {
      historyList.innerHTML = ""; // Bersihkan isi riwayat terlebih dahulu

      // Jika tidak ada data pengeluaran
      if (pengeluaranData.length === 0) {
        historyList.innerHTML = `
          <div class="empty-state">
            <i class="bi bi-wallet2" style="font-size: 2rem; color: var(--primary);"></i>
            <p style="margin-top: 10px;">Belum ada riwayat pengeluaran</p>
          </div>
        `;
        return;
      }

      // Urutkan data dari yang terbaru berdasarkan tanggal
      const sorted = [...pengeluaranData].sort((a, b) => new Date(b.tanggal) - new Date(a.tanggal));
      const latestFive = sorted.slice(0, 5); // Ambil 5 data paling baru

      // Tampilkan setiap item dalam bentuk div
      latestFive.forEach(item => {
        const formattedDate = new Date(item.tanggal).toLocaleDateString('id-ID', {
          day: '2-digit',
          month: 'long',
          year: 'numeric'
        });

        const div = document.createElement("div");
        div.className = "history-item";
        div.innerHTML = `
          <div>
            <div>${item.keterangan}</div>
            <div class="history-date">${formattedDate}</div>
          </div>
          <div>Rp ${item.jumlah.toLocaleString('id-ID')}</div>
        `;
        historyList.appendChild(div);
      });
    }

    // Event ketika form disubmit (tombol Tambah ditekan)
    form.addEventListener("submit", (e) => {
      e.preventDefault(); // Cegah reload halaman

      // Ambil nilai dari input
      const keterangan = document.getElementById("keterangan").value.trim();
      const jumlah = parseInt(document.getElementById("jumlah").value);
      const tanggal = document.getElementById("tanggal").value;

      // Validasi input
      if (!keterangan || !jumlah || isNaN(jumlah) || !tanggal) {
        alert("Semua field harus diisi dengan benar.");
        return;
      }

      // Tambahkan data baru ke array
      pengeluaranData.push({ keterangan, jumlah, tanggal });

      // Simpan data ke localStorage
      localStorage.setItem("pengeluaranData", JSON.stringify(pengeluaranData));

      // Tampilkan kembali daftar pengeluaran terbaru
      renderPengeluaran();

      // Reset form
      form.reset();
      
      // Fokus ke field keterangan
      document.getElementById("keterangan").focus();
    });

    // Event saat tombol hapus diklik
    listPengeluaran.addEventListener("click", (e) => {
      if (e.target.classList.contains("btn-delete") || e.target.closest(".btn-delete")) {
        const btn = e.target.classList.contains("btn-delete") ? e.target : e.target.closest(".btn-delete");
        const idx = btn.dataset.idx;
        
        if (confirm("Yakin ingin menghapus data ini?")) {
          pengeluaranData.splice(idx, 1);
          localStorage.setItem("pengeluaranData", JSON.stringify(pengeluaranData));
          renderPengeluaran();
        }
      }
    });

    // Set tanggal default ke hari ini
    document.getElementById("tanggal").valueAsDate = new Date();

    // Render data saat pertama kali halaman dibuka
    renderPengeluaran();
  </script>
</body>
</html>