<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Siswa</title>
  <link rel="shortcut icon" href="rpl.png" type="image/x-icon" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --primary: #4a6cf7;
      --primary-light: #6a8aff;
      --primary-dark: #3a5ae0;
      --success: #28a745;
      --warning: #ffc107;
      --danger: #dc3545;
      --light: #f8f9fa;
      --dark: #1e293b;
      --card-bg: #ffffff;
      --input-bg: #f8fafc;
      --border-color: #e2e8f0;
      --shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
      --transition: all 0.3s ease;
      --dashboard-bg: #f5f7fb;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    body {
      background: var(--dashboard-bg);
      min-height: 100vh;
      padding: 30px 20px;
      color: var(--dark);
    }

    .container {
      max-width: 1000px;
      background: var(--card-bg);
      padding: 30px;
      border-radius: 20px;
      box-shadow: var(--shadow);
      margin: auto;
      border: 1px solid var(--border-color);
      animation: fadeIn 0.6s ease-out;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .header-section {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      color: var(--primary);
      font-weight: 600;
      text-decoration: none;
      transition: var(--transition);
      padding: 8px 16px;
      border-radius: 8px;
      background: rgba(74, 108, 247, 0.1);
    }

    .back-btn:hover {
      color: var(--primary-dark);
      background: rgba(74, 108, 247, 0.2);
      text-decoration: none;
    }

    h2 {
      font-weight: 700;
      color: var(--dark);
      text-align: center;
      margin-bottom: 5px;
    }

    .subtitle {
      text-align: center;
      color: var(--secondary);
      margin-bottom: 25px;
      font-size: 0.95rem;
    }

    .search-reset-container {
      display: flex;
      justify-content: space-between;
      gap: 15px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .search-box {
      flex: 1;
      min-width: 250px;
      position: relative;
    }

    .search-box i {
      position: absolute;
      left: 15px;
      top: 12px;
      color: var(--primary);
    }

    #searchInput {
      width: 100%;
      padding: 12px 15px 12px 45px;
      border-radius: 12px;
      border: 2px solid var(--border-color);
      background: var(--input-bg);
      font-size: 15px;
      transition: var(--transition);
      outline: none;
      color: var(--dark);
    }

    #searchInput:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(74, 108, 247, 0.2);
    }

    #resetKas {
      background: var(--danger);
      border: none;
      color: white;
      padding: 12px 20px;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition);
      display: flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }

    #resetKas:hover {
      background: #b02a37;
      transform: translateY(-2px);
    }

    .student-table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 0 8px;
      margin-top: 15px;
    }

    .student-table thead {
      background: linear-gradient(90deg, var(--primary), var(--primary-light));
      color: white;
    }

    .student-table th {
      padding: 15px;
      text-align: center;
      font-weight: 600;
      font-size: 15px;
    }

    .student-table tbody tr {
      background: var(--input-bg);
      border-radius: 12px;
      transition: var(--transition);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .student-table tbody tr:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }

    .student-table td {
      padding: 15px;
      text-align: center;
      vertical-align: middle;
    }

    .text-start {
      text-align: left !important;
    }

    .status-badge {
      display: inline-block;
      padding: 6px 12px;
      border-radius: 20px;
      font-weight: 600;
      font-size: 14px;
    }

    .status-lunas {
      background: rgba(40, 167, 69, 0.1);
      color: var(--success);
    }

    .status-belum {
      background: rgba(220, 53, 69, 0.1);
      color: var(--danger);
    }

    .total-kas {
      text-align: right;
      margin-top: 25px;
      padding: 15px;
      background: rgba(74, 108, 247, 0.1);
      border-radius: 12px;
      font-weight: 700;
      color: var(--primary);
      font-size: 16px;
    }

    /* Responsive styles */
    @media (max-width: 768px) {
      .container {
        padding: 20px;
      }
      
      .student-table {
        display: block;
        overflow-x: auto;
      }
      
      .student-table thead {
        display: none;
      }
      
      .student-table tbody tr {
        display: block;
        margin-bottom: 15px;
      }
      
      .student-table td {
        display: flex;
        justify-content: space-between;
        align-items: center;
        text-align: right !important;
        padding: 10px 15px;
      }
      
      .student-table td::before {
        content: attr(data-label);
        font-weight: 600;
        color: var(--dark);
        margin-right: auto;
        padding-right: 20px;
      }
      
      .student-table td.text-start {
        justify-content: flex-start;
      }
      
      .status-badge {
        margin-left: auto;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="header-section">
      <a href="dashboard.html" class="back-btn">
        <i class="bi bi-arrow-left"></i> Kembali ke Dashboard
      </a>
      
      <div>
        <h2>Data Siswa Kelas</h2>
        <p class="subtitle">Status pembayaran kas minggu ini</p>
      </div>
      
      <div style="width: 100%;"></div> <!-- Spacer -->
    </div>

    <div class="search-reset-container">
      <div class="search-box">
        <i class="bi bi-search"></i>
        <input type="text" id="searchInput" placeholder="Cari nama siswa..." />
      </div>
      
      <button id="resetKas">
        <i class="bi bi-arrow-clockwise"></i> Reset Kas Mingguan
      </button>
    </div>

    <table class="student-table">
      <thead>
        <tr>
          <th>No</th>
          <th>Nama Siswa</th>
          <th>Kelas</th>
          <th>Status Kas</th>
          <th>Total Bayar</th>
        </tr>
      </thead>
      <tbody id="siswaTable"></tbody>
    </table>

    <div class="total-kas" id="totalKas"></div>
  </div>

  <script>
    // Daftar nama siswa
    const siswaList = [
      "ACENG WILDAN LAKSANA", "AFGHAN GENOVA SUDRAJAT", "AGIS RAMADANI",
      "ALIF DENIS HERDIANTO", "ALIN JULIANI", "AULIA MARDIANA PUTRI",
      "AULIA RAMADANI", "AYU NURAENI", "BAMBANG KAMAJAYA SURYa",
      "CHARISTA CAMELIA", "DELISA YULIANTI", "DEUIS SITI MUNIFAH",
      "DINAR RESKI FAUZI", "FADLIANSYAH RIZKI", "FAKIH SABIKUL HOER",
      "HAMDAN", "IKHSAN MULIA APRIANA", "IMELDA NURCAHYANI",
      "KURNIA", "MAHESWARI RIHADATUL AIS", "MOCHAMAD AL FAREL DWI SEPTIAN",
      "NABIL ALPATH ABDUL ROZAI", "NAZWA FITRIYANI", "NINDY HENDRYANTY",
      "PUJI MAHARANI", "RAFKA JULIAN PRATAMA", "RARA NURUL FADHILAH",
      "RESTI AWALIA", "SAEPUL ANWAR", "SAFFIYA QOISARO RUSTENDI",
      "SITI FARIDAH", "SITI NURWAHIDAH", "SYADRAH TITIK QADAR",
      "TIRTA IBNU WIBOWO", "YUNISHA RAMADHANI", "ZEINA VANKA AZZAHRA"
    ];

    // Urutkan nama siswa alfabetis
    siswaList.sort();

    // Ambil data kas dari localStorage
    const kasData = JSON.parse(localStorage.getItem("kasData")) || [];

    // Fungsi untuk mengecek apakah tanggal ada dalam minggu ini
    function isThisWeek(dateStr) {
      const date = new Date(dateStr);
      const now = new Date();
      const start = new Date(now);
      start.setDate(now.getDate() - now.getDay());
      start.setHours(0, 0, 0, 0);
      const end = new Date(start);
      end.setDate(start.getDate() + 6);
      end.setHours(23, 59, 59, 999);
      return date >= start && date <= end;
    }

    // Tampilkan data siswa ke tabel
    const tableBody = document.getElementById("siswaTable");
    const totalKasEl = document.getElementById("totalKas");
    let totalKas = 0;

    siswaList.forEach((nama, i) => {
      // Hitung total pembayaran minggu ini
      const totalBayar = kasData
        .filter(d => d.nama === nama && isThisWeek(d.tanggal))
        .reduce((sum, d) => sum + d.jumlah, 0);

      totalKas += totalBayar;

      const status = totalBayar >= 2000 ? "Lunas" : "Belum Lunas";
      const statusClass = totalBayar >= 2000 ? "status-lunas" : "status-belum";

      // Tambahkan baris ke tabel
      const row = document.createElement("tr");
      row.innerHTML = `
        <td data-label="No">${i + 1}</td>
        <td class="text-start" data-label="Nama">${nama}</td>
        <td data-label="Kelas">X RPL 1</td>
        <td data-label="Status Kas">
          <span class="status-badge ${statusClass}">${status}</span>
        </td>
        <td data-label="Total Bayar">Rp ${totalBayar.toLocaleString('id-ID')}</td>
      `;
      tableBody.appendChild(row);
    });

    // Tampilkan total kas
    totalKasEl.textContent = `Total Kas Minggu Ini: Rp ${totalKas.toLocaleString('id-ID')}`;

    // Fungsi reset kas minggu ini
    document.getElementById("resetKas").addEventListener("click", () => {
      if (confirm("Apakah kamu yakin ingin mereset data kas minggu ini?\nSemua catatan pembayaran minggu ini akan dihapus.")) {
        const now = new Date();
        const start = new Date(now);
        start.setDate(now.getDate() - now.getDay());
        start.setHours(0, 0, 0, 0);
        const end = new Date(start);
        end.setDate(start.getDate() + 6);
        end.setHours(23, 59, 59, 999);

        // Simpan hanya data kas di luar minggu ini
        const kasDataLama = JSON.parse(localStorage.getItem("kasData")) || [];
        const kasDataBaru = kasDataLama.filter(entry => {
          const tgl = new Date(entry.tanggal);
          return tgl < start || tgl > end;
        });

        localStorage.setItem("kasData", JSON.stringify(kasDataBaru));
        
        // Beri feedback visual
        const btn = document.getElementById("resetKas");
        btn.innerHTML = '<i class="bi bi-check-circle"></i> Berhasil Direset';
        btn.style.background = 'var(--success)';
        
        setTimeout(() => {
          location.reload();
        }, 1500);
      }
    });

    // Fungsi pencarian nama
    document.getElementById("searchInput").addEventListener("input", function () {
      const keyword = this.value.toLowerCase();
      const rows = document.querySelectorAll("#siswaTable tr");
      
      rows.forEach(row => {
        const nama = row.querySelector("td.text-start").textContent.toLowerCase();
        row.style.display = nama.includes(keyword) ? "" : "none";
      });
    });
  </script>
</body>
</html>