<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Data Siswa</title>
  <link rel="shortcut icon" href="rpl.png" type="image/x-icon" />
  <!-- Bootstrap dan font -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet" />

  <style>
    /* Gaya umum halaman */
    body {
      font-family: 'Poppins', sans-serif;
      background: linear-gradient(to right, #e0f7fa, #fff);
      min-height: 100vh;
      padding: 30px 10px;
      color: #333;
    }

    .container {
      max-width: 960px;
      background: #ffffff;
      padding: 35px 45px;
      border-radius: 15px;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
    }

    /* Judul halaman */
    h2 {
      font-weight: 600;
      margin-bottom: 25px;
      color: #1c2b36;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    /* Tombol kembali */
    .btn-back {
      margin-bottom: 20px;
      background-color: #17a2b8;
      border: none;
      font-weight: 600;
      letter-spacing: 0.5px;
      color: #fff;
      padding: 8px 20px;
      border-radius: 8px;
    }

    .btn-back:hover {
      background-color: #138496;
    }

    /* Tombol reset */
    #resetKas {
      font-weight: 600;
      background-color: #dc3545;
      border: none;
      letter-spacing: 0.05em;
      padding: 10px 20px;
      border-radius: 8px;
      color: #fff;
      margin-bottom: 15px;
      float: right;
    }

    #resetKas:hover {
      background-color: #b02a37;
    }

    /* Input pencarian */
    #searchInput {
      padding: 10px 15px;
      border: 2px solid #17a2b8;
      border-radius: 8px;
      font-size: 15px;
      margin-bottom: 20px;
    }

    /* Tabel data siswa */
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 15px;
    }

    thead {
      background: #17a2b8;
      color: #fff;
    }

    thead th {
      padding: 14px;
      text-align: center;
      font-size: 15.5px;
      font-weight: 600;
    }

    tbody tr:nth-child(even) {
      background-color: #f8f9fa;
    }

    tbody tr:hover {
      background-color: #e0f7fa;
    }

    tbody td {
      padding: 14px;
      text-align: center;
      font-size: 14.5px;
    }

    .text-start {
      text-align: left !important;
    }

    .status-lunas {
      color: #28a745;
      font-weight: 700;
    }

    .status-belum {
      color: #dc3545;
      font-weight: 700;
    }

    #totalKas {
      font-size: 16px;
      font-weight: 600;
      text-align: right;
      margin-top: 20px;
      color: #007b5e;
    }

    /* Tampilan mobile */
    @media screen and (max-width: 576px) {
      thead {
        display: none;
      }

      table,
      tbody,
      tr,
      td {
        display: block;
        width: 100%;
      }

      tr {
        margin-bottom: 15px;
        background-color: #f9f9f9;
        padding: 10px;
        border-radius: 10px;
      }

      td {
        text-align: left;
        padding: 6px 10px;
        font-size: 15px;
        position: relative;
      }

      td::before {
        content: attr(data-label);
        font-weight: bold;
        display: block;
        margin-bottom: 4px;
        color: #666;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <!-- Tombol kembali ke dashboard -->
    <a href="dashboard.html" class="btn btn-back">‚Üê Kembali ke Dashboard</a>

    <!-- Judul -->
    <h2>Data Siswa & Status Kas</h2>

    <!-- Input pencarian nama -->
    <input type="text" id="searchInput" placeholder="Cari nama siswa..." class="form-control mb-3" />

    <!-- Tombol reset kas -->
    <button id="resetKas">Reset Kas Mingguan</button>

    <!-- Tabel data siswa -->
    <table>
      <thead>
        <tr>
          <th>No</th>
          <th>Nama Siswa</th>
          <th>Kelas</th>
          <th>Status Kas</th>
          <th>Total Bayar</th>
        </tr>
      </thead>
      <tbody id="siswaTable"></tbody>
    </table>

    <!-- Total kas -->
    <p id="totalKas"></p>
  </div>

  <script>
    // Daftar nama siswa
    const siswaList = [
      "ACENG WILDAN LAKSANA", "AFGHAN GENOVA SUDRAJAT", "AGIS RAMADANI",
      "ALIF DENIS HERDIANTO", "ALIN JULIANI", "AULIA MARDIANA PUTRI",
      "AULIA RAMADANI", "AYU NURAENI", "BAMBANG KAMAJAYA SURYa",
      "CHARISTA CAMELIA", "DELISA YULIANTI", "DEUIS SITI MUNIFAH",
      "DINAR RESKI FAUZI", "FADLIANSYAH RIZKI", "FAKIH SABIKUL HOER",
      "HAMDAN", "IKHSAN MULIA APRIANA", "IMELDA NURCAHYANI",
      "KURNIA", "MAHESWARI RIHADATUL AIS", "MOCHAMAD AL FAREL DWI SEPTIAN",
      "NABIL ALPATH ABDUL ROZAI", "NAZWA FITRIYANI", "NINDY HENDRYANTY",
      "PUJI MAHARANI", "RAFKA JULIAN PRATAMA", "RARA NURUL FADHILAH",
      "RESTI AWALIA", "SAEPUL ANWAR", "SAFFIYA QOISARO RUSTENDI",
      "SITI FARIDAH", "SITI NURWAHIDAH", "SYADRAH TITIK QADAR",
      "TIRTA IBNU WIBOWO", "YUNISHA RAMADHANI", "ZEINA VANKA AZZAHRA"
    ];

    // Urutkan nama siswa alfabetis
    siswaList.sort();

    // Ambil data kas dari localStorage
    const kasData = JSON.parse(localStorage.getItem("kasData")) || [];

    // Fungsi untuk mengecek apakah tanggal ada dalam minggu ini
    function isThisWeek(dateStr) {
      const date = new Date(dateStr);
      const now = new Date();
      const start = new Date(now);
      start.setDate(now.getDate() - now.getDay());
      start.setHours(0, 0, 0, 0);
      const end = new Date(start);
      end.setDate(start.getDate() + 6);
      end.setHours(23, 59, 59, 999);
      return date >= start && date <= end;
    }

    // Tampilkan data siswa ke tabel
    const tableBody = document.getElementById("siswaTable");
    const totalKasEl = document.getElementById("totalKas");
    let totalKas = 0;

    siswaList.forEach((nama, i) => {
      // Hitung total pembayaran minggu ini
      const totalBayar = kasData
        .filter(d => d.nama === nama && isThisWeek(d.tanggal))
        .reduce((sum, d) => sum + d.jumlah, 0);

      totalKas += totalBayar;

      const status = totalBayar >= 2000 ? "Lunas" : "Belum Lunas";
      const statusClass = totalBayar >= 2000 ? "status-lunas" : "status-belum";

      // Tambahkan baris ke tabel
      const row = document.createElement("tr");
      row.innerHTML = `
        <td data-label="No">${i + 1}</td>
        <td class="text-start" data-label="Nama">${nama}</td>
        <td data-label="Kelas">X RPL 1</td>
        <td data-label="Status Kas" class="${statusClass}">${status}</td>
        <td data-label="Total Bayar">Rp ${totalBayar.toLocaleString()}</td>
      `;
      tableBody.appendChild(row);
    });

    // Tampilkan total kas
    totalKasEl.textContent = `Total Kas Minggu Ini: Rp ${totalKas.toLocaleString()}`;

    // Fungsi reset kas minggu ini
    document.getElementById("resetKas").addEventListener("click", () => {
      if (confirm("Apakah kamu yakin ingin mereset data kas minggu ini?")) {
        const now = new Date();
        const start = new Date(now);
        start.setDate(now.getDate() - now.getDay());
        start.setHours(0, 0, 0, 0);
        const end = new Date(start);
        end.setDate(start.getDate() + 6);
        end.setHours(23, 59, 59, 999);

        // Simpan hanya data kas di luar minggu ini
        const kasDataLama = JSON.parse(localStorage.getItem("kasData")) || [];
        const kasDataBaru = kasDataLama.filter(entry => {
          const tgl = new Date(entry.tanggal);
          return tgl < start || tgl > end;
        });

        localStorage.setItem("kasData", JSON.stringify(kasDataBaru));
        alert("Data kas minggu ini telah direset.");
        location.reload();
      }
    });

    // Fungsi pencarian nama
    document.getElementById("searchInput").addEventListener("input", function () {
      const keyword = this.value.toLowerCase();
      const rows = document.querySelectorAll("#siswaTable tr");
      rows.forEach(row => {
        const nama = row.children[1].textContent.toLowerCase();
        row.style.display = nama.includes(keyword) ? "" : "none";
      });
    });
  </script>
</body>

</html>